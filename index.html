<!DOCTYPE html>
  <html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pixboard</title>
  <script src="https://cdn.tailwindcss.com"></script>
<link rel="stylesheet" href="style.css">
  </head>
<body class="h-screen flex flex-col">
  <header id="mainHeader" class="top">
    <div class="row">
      <h1 data-i18n="title">Pixboard</h1>
      <div class="spacer"></div>
      <input type="file" id="singleFileInput" accept="image/*" multiple>
      <select id="langSelect">
        <option value="en">English</option>
        <option value="ja">日本語</option>
      </select>
      <button class="btn" onclick="openBatchEditor()" data-i18n="batchBtn">Batch Process</button>
      <button class="btn" onclick="toggleSidebars()" data-i18n="toggleUI">Toggle UI</button>
    </div>
  </header>

  <main id="singleEditor" class="flex flex-1 overflow-hidden">
    <aside id="leftSidebar" class="sidebar w-44 p-2 overflow-y-auto space-y-2">
      <div class="space-y-2">
        <button class="btn" onclick="rotate(-90)" data-i18n="rotateLeft">Rotate -90°</button>
        <button class="btn" onclick="rotate(90)" data-i18n="rotateRight">Rotate +90°</button>
        <button class="btn" onclick="flipX()" data-i18n="flipH">Flip Horizontal</button>
        <button class="btn" onclick="flipY()" data-i18n="flipV">Flip Vertical</button>
        <button class="btn" onclick="undo()" data-i18n="undoBtn">Undo</button>
        <button class="btn" onclick="redo()" data-i18n="redoBtn">Redo</button>
      </div>
      <div class="space-y-2">
        <label class="block" data-i18n="widthLabel">Width:</label>
        <input class="w-full" type="number" id="width" value="0">
        <label class="block" data-i18n="heightLabel">Height:</label>
        <input class="w-full" type="number" id="height" value="0">
        <button class="btn w-full" onclick="resizeCanvas()" data-i18n="resizeBtn">Resize</button>
      </div>
    </aside>

    <section class="flex-1 flex items-center justify-center overflow-auto">
      <canvas id="canvas" class="my-2"></canvas>
    </section>

    <aside id="rightSidebar" class="sidebar w-64 p-2 overflow-y-auto space-y-2">
      <h3 class="font-semibold" data-i18n="adjustHeading">画像調整</h3>
      <div class="flex items-center gap-2">
        <label data-i18n="brightnessLabel">Brightness:</label>
        <input type="range" id="brightness" min="-100" max="100" value="0" oninput="setBrightness(this.value)">
      </div>
      <div class="flex items-center gap-2">
        <label data-i18n="contrastLabel">Contrast:</label>
        <input type="range" id="contrast" min="-100" max="100" value="0" oninput="setContrast(this.value)">
      </div>
      <div class="flex items-center gap-2">
        <label data-i18n="saturationLabel">Saturation Threshold:</label>
        <input type="range" id="saturationThreshold" min="0" max="100" value="50" oninput="setSaturationThreshold(this.value)">
      </div>
        <div class="flex items-center gap-2">
          <label data-i18n="saturationAdjLabel">Saturation:</label>
          <input type="range" id="saturation" min="-100" max="100" value="0" oninput="setSaturation(this.value)">
        </div>
        <div class="flex items-center gap-2">
          <label data-i18n="hueLabel">Hue:</label>
          <input type="range" id="hue" min="-180" max="180" value="0" oninput="setHue(this.value)">
        </div>
        <div class="flex items-center gap-2">
          <label data-i18n="sharpnessLabel">Sharpness:</label>
          <input type="range" id="sharpness" min="0" max="5" step="0.1" value="0" oninput="setSharpness(this.value)">
        </div>
        <div class="flex items-center gap-2">
          <label data-i18n="blurLabel">Blur:</label>
          <input type="range" id="blur" min="0" max="10" step="0.5" value="0" oninput="setBlur(this.value)">
        </div>
        <div class="flex items-center gap-2">
          <label data-i18n="invertLabel">Invert:</label>
          <input type="checkbox" id="invert" onchange="setInvert(this.checked)">
        </div>
      <div class="flex items-center gap-2">
        <label data-i18n="zoomLabel">Zoom:</label>
        <input type="range" id="zoom" min="50" max="200" value="100" oninput="setZoom(this.value)">
      </div>

      <div class="flex items-center gap-2">
        <button class="btn" id="colorPickerBtn" data-i18n="colorPickerBtn">Color Picker</button>
        <span data-i18n="pickedColorLabel">Color:</span>
        <span id="pickedColor">#FFFFFF</span>
      </div>

      <div class="flex items-center gap-2">
        <label data-i18n="distortLabel">Distortion:</label>
        <input type="range" id="distortAmount" min="-2" max="2" step="0.1" value="0">
        <button class="btn" id="distortBtn" data-i18n="distortBtn">Apply Distortion</button>
      </div>

      <h3 class="font-semibold" data-i18n="filterHeading">フィルター</h3>
      <div id="filter-buttons" class="flex flex-wrap gap-2">
        <button data-filter="none" onclick="setFilter('none')" class="btn active" data-i18n="filterNormal">Normal</button>
        <button data-filter="grayscale" onclick="setFilter('grayscale')" class="btn" data-i18n="filterGray">Grayscale</button>
        <button data-filter="sepia" onclick="setFilter('sepia')" class="btn" data-i18n="filterSepia">Sepia</button>
        <button data-filter="saturation-gray" onclick="setFilter('saturation-gray')" class="btn" data-i18n="filterPartial">Partial Grayscale</button>
      </div>

      <div class="flex flex-wrap gap-2 items-center">
        <input type="text" id="textInput" placeholder="Text" data-i18n-placeholder="textPlaceholder">
        <input type="color" id="textColor" value="#000000">
        <input type="number" id="textSize" value="20" class="w-16">
        <button class="btn" onclick="enableTextMode()" data-i18n="addTextBtn">Add Text</button>
        <button class="btn" onclick="enableMaskMode()" data-i18n="maskModeBtn">Mask Mode</button>
      </div>

      <h3 class="font-semibold" data-i18n="stickerHeading">Stickers</h3>
      <div id="sticker-container" class="flex flex-wrap gap-2"></div>

      <div id="layer-controls" class="flex flex-wrap gap-2 items-center hidden">
        <button class="btn" onclick="bringForward()" data-i18n="bringForwardBtn">Bring Forward</button>
        <button class="btn" onclick="sendBackward()" data-i18n="sendBackwardBtn">Send Backward</button>
        <button class="btn" onclick="deleteLayer()" data-i18n="deleteBtn">Delete</button>
        <label data-i18n="wLabel">W:</label><input id="layerWidth" type="number" class="w-16" onchange="updateLayerSize()">
        <label data-i18n="hLabel">H:</label><input id="layerHeight" type="number" class="w-16" onchange="updateLayerSize()">
        <label data-i18n="rotLabel">Rot:</label><input id="layerRotation" type="number" class="w-16" onchange="updateLayerRotation()">
      </div>
    </aside>
  </main>

  <section id="batchContainer" class="hidden">
    <header class="top">
      <div class="row">
        <button class="btn" onclick="closeBatchEditor()">Back to Pixboard</button>
        <h1>画像一括編集</h1>
        <div class="spacer"></div>
        <button id="openDir" class="btn primary">フォルダを開く（./pictures 推奨）</button>
        <button id="openDirFallback" class="btn ghost">フォルダ選択（互換）</button>
        <input id="dirInput" type="file" webkitdirectory multiple hidden />
        <button id="addFiles" class="btn">個別ファイルを追加</button>
        <input id="fileInput" type="file" accept="image/*" multiple hidden />
        <button id="exportAll" class="btn success">エクスポート</button>
        <button id="toggleControlsBtn" class="btn ghost" onclick="toggleBatchControls()" data-i18n="toggleControls">Controls</button>
        <div class="spacer"></div>
        <span class="chip" id="countChip">0 枚</span>
        <span class="chip" id="selChip">選択 0</span>
      </div>
      <div class="row gap">
        <div class="seg" role="tablist" aria-label="表示モード">
          <button id="modeTile" class="segbtn active" role="tab" aria-selected="true">タイル一括編集</button>
          <button id="modeSingle" class="segbtn" role="tab" aria-selected="false">一括単品編集</button>
        </div>

        <div class="seg" role="tablist" aria-label="適用対象">
          <button id="scopeAuto" class="segbtn active" role="tab" aria-selected="true" title="選択があれば選択、なければ全体">自動</button>
          <button id="scopeSel" class="segbtn" role="tab" aria-selected="false" title="選択のみ">選択</button>
          <button id="scopeAll" class="segbtn" role="tab" aria-selected="false" title="全体">全体</button>
          <button id="scopeExceptSel" class="segbtn" role="tab" aria-selected="false" title="選択以外">非選択</button>
        </div>
        <div class="seg" role="tablist" aria-label="ファイル名モード">
          <button id="nameSimple" class="segbtn active" role="tab" aria-selected="true">_edited</button>
          <button id="nameDetail" class="segbtn" role="tab" aria-selected="false">編集内容</button>
        </div>
        <div class="seg" role="tablist" aria-label="タイル密度">
          <button id="tightTiles" class="segbtn active" role="tab" aria-selected="true" title="余白3px・最大表示">最大タイル</button>
        </div>
      </div>

      <div id="controls" class="controls hidden">
        <div class="ctrl" data-key="temp" data-step="5" data-reset="0">
          <label>色温度（寒色 ← 0 → 暖色）<span class="val" id="tempVal">0</span></label>
          <div class="row">
            <button class="mini minus">-1</button>
            <input id="tempRange" type="range" min="-100" max="100" value="0" step="1" />
            <button class="mini plus">+1</button>
            <button class="mini reset">規定値</button>
          </div>
        </div>

        <div class="ctrl" data-key="brightnessPct" data-step="5" data-reset="100">
          <label>明るさ（%）<span class="val" id="brightVal">100%</span></label>
          <div class="row">
            <button class="mini minus">-1</button>
            <input id="brightRange" type="range" min="0" max="200" value="100" step="1" />
            <button class="mini plus">+1</button>
            <button class="mini reset">規定値</button>
          </div>
        </div>

        <div class="ctrl" data-key="ev" data-step="0.1" data-reset="0">
          <label>露光（EV）<span class="val" id="expoVal">0.0</span></label>
          <div class="row">
            <button class="mini minus">-1</button>
            <input id="expoRange" type="range" min="-4" max="4" value="0" step="0.1" />
            <button class="mini plus">+1</button>
            <button class="mini reset">規定値</button>
          </div>
        </div>

        <div class="ctrl" data-key="contrastPct" data-step="5" data-reset="100">
          <label>コントラスト（%）<span class="val" id="contVal">100%</span></label>
          <div class="row">
            <button class="mini minus">-1</button>
            <input id="contRange" type="range" min="0" max="200" value="100" step="1" />
            <button class="mini plus">+1</button>
            <button class="mini reset">規定値</button>
          </div>
        </div>

        <div class="ctrl" data-key="gamma" data-step="0.1" data-reset="1.0">
          <label>ガンマ（γ）<span class="val" id="gammaVal">1.00</span></label>
          <div class="row">
            <button class="mini minus">-1</button>
            <input id="gammaRange" type="range" min="0.10" max="3.00" value="1.00" step="0.01" />
            <button class="mini plus">+1</button>
            <button class="mini reset">規定値</button>
          </div>
        </div>

        <div class="ctrl" data-key="saturationPct" data-step="5" data-reset="100">
          <label>彩度（%）<span class="val" id="satVal">100%</span></label>
          <div class="row">
            <button class="mini minus">-1</button>
            <input id="satRange" type="range" min="0" max="200" value="100" step="1" />
            <button class="mini plus">+1</button>
            <button class="mini reset">規定値</button>
          </div>
        </div>

        <div class="ctrl auto" data-key="auto" data-step="0.05" data-reset="0">
          <label>自動明るさ（平均±指定・強さ）<span class="val" id="autoVal">OFF</span></label>
          <div class="row">
            <input id="autoEnable" type="checkbox" />
            <span class="muted">有効</span>
            <span class="muted">Pivotオフセット</span>
            <input id="autoPivot" type="range" min="-0.30" max="0.30" value="0" step="0.01" />
            <span class="muted">強さ</span>
            <input id="autoStrength" type="range" min="0" max="2" value="1" step="0.05" />
            <button id="autoRecalc" class="mini">再計算</button>
          </div>
        </div>
      </div>

      <div class="row gap">
        <div class="seg" role="tablist" aria-label="表示モード">
          <button id="modeTile" class="segbtn active" role="tab" aria-selected="true">タイル一括編集</button>
          <button id="modeSingle" class="segbtn" role="tab" aria-selected="false">一括単品編集</button>
        </div>

        <button id="selectAll" class="btn ghost">全選択</button>
        <button id="clearSel" class="btn ghost">選択クリア</button>
        <span class="muted">クリック＝トグル、Shift+Click＝範囲選択。選択は太枠で表示。</span>
      </div>
    </header>

    <main id="grid" class="grid tight" aria-live="polite"></main>

    <section id="split" class="split" aria-live="polite">
      <div class="leftPanel">
        <div id="thumbGrid" class="leftGrid"></div>
      </div>
      <div class="rightPanel">
        <div class="detailHeader">
          <span class="chip">単品編集中</span>
          <span id="detailName" class="detailName"></span>
        </div>
        <div class="detailCanvasWrap">
          <canvas id="detailCanvas"></canvas>
        </div>
      </div>
    </section>

  </section>

  <footer class="p-2 flex justify-center gap-2">
    <button class="btn" onclick="cropCanvas()" data-i18n="cropBtn">トリミング</button>
    <button class="btn" onclick="savePNG()" data-i18n="savePngBtn">Save PNG</button>
    <button class="btn" onclick="saveJPG()" data-i18n="saveJpgBtn">Save JPG</button>
    <button class="btn" onclick="resetEditor()" data-i18n="resetBtn">すべてリセット</button>
  </footer>

  <script src="script.js"></script>
</body>
</html>